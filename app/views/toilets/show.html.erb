<div class="container">
  <%= link_to 'back', toilets_path, class: 'fine-sm-text' %>
</div>
<div class="container details-container">
  <ul class="icons icons-vertical">

    <li><i class="fas fa-book <%= 'active' if @toilet.reading_material %>"  data-toggle="tooltip" data-placement="left" title="reading material"></i></li>
    <li><i class="fas fa-image <%= 'active' if @toilet.window %>" data-toggle="tooltip" data-placement="left" title="shit with view"></i></li>
    <li><i class="fas fa-music <%= 'active' if @toilet.speakers %>" data-toggle="tooltip" data-placement="left" title="bring your tunes"></i></li>
    <li><i class="fas fa-thermometer-half <%= 'active' if @toilet.floor_heating %>" data-toggle="tooltip" data-placement="left" title="warm feet"></i></li>
    <li><i class="fas fa-wifi <%= 'active' if @toilet.wifi %>" data-toggle="tooltip" data-placement="left" title="shit and surf"></i></li>
    <li></li>
  </ul>
  <div class="img-container">
    <%=  cl_image_tag @toilet.photo, height: 500, width: 500, crop: :fill %>
  </div>
  <div class="listing-details">
    <h2><%= @toilet.name%></h2>
    <div class="stars"></div>
    <p class="toilet-description"><%= @toilet.description %></p>
    <% if @existing_booking && @existing_booking.active_booking == true  %>
      <h4>You are currently on the toilet.</h4>
        <%= simple_form_for [@toilet, @existing_booking], method: :patch do |f| %>
        <%= f.button :submit, "I'm done!", class: 'btn btn-submit btn-green' %>
        <% end %>
    <% elsif @toilet.available %>
      <div class="availability">
          <i class="fas fa-door-open available"></i>
          <i class="fas fa-door-closed"></i>
      </div>
      <% if policy(Booking).create? %>
        <h4>Book this toilet for <%= @toilet.price %>â‚¬:</h4>
        <%= simple_form_for [@toilet, @booking] do |f| %>
        <%= f.button :submit, class: 'btn btn-submit' %>
        <% end %>
      <% end %>
    <% else %>
      <div class="availability">
          <i class="fas fa-door-open"></i>
          <i class="fas fa-door-closed not-available"></i>
      </div>
      <p>This toilet is not currently available for bookings.</p>
    <% end %>

  </div>
</div>

<div class="map-banner">
  <div class="map-results">
    <div
      id="map"
      style="width: 100%;
      height: 500px;"
      data-markers="<%= @marker.to_json %>"
      data-mapbox-api-key="<%= ENV['MAPBOX_API_KEY'] %>"
    ></div>
  </div>
</div>

<div class="container">
  <h2>Reviews for this toilet:</h2>

  <!-- this doesn't work. -->
  <!-- create a @toilet.overall_rating method in model -->
  <!-- need to make the condition based on REVIEWS NOT BOOKINGS -->
  <% if @toilet.reviews.empty? %>
    <p>This toilet doesn't have any reviews yet</p>
  <% else %>
    <div class="stars">
      <ul class="stars stars-lg">
        <li><i class="fas fa-star"></i></li>
        <li><i class="fas fa-star"></i></li>
        <li><i class="fas fa-star"></i></li>
        <li><i class="fas fa-star"></i></li>
      </ul>
    </div>

    <% @toilet.reviews.each do |review| %>
      <div class="review-card">
        <img class="avatar-large" src="https://kitt.lewagon.com/placeholder/users/random" alt="">
        <div class="review-card-content">
          <div class="review-card-headings">
            <h3></h3>
            <p>March 2018</p>
          </div>
          <div>
            <p><%= review.description %></p>
          </div>
        </div>
      </div>
    <% end %>
  <% end %>

</div>

<div class="container">
  <h2>Other toilets nearby:</h2>
  <div class="row">
    <% @toilets.each do |toilet| %>
      <div class="col-12 col-lg-4">
        <%= link_to toilet_path(toilet) do %>
          <div class="card toilet-card">
            <div class="toilet-img" style="background-image: url(<%= photo_or_placeholder(toilet) %>)"></div>
            <div class="card-content">
              <h6><%=h truncate(toilet.name, length:27) %></h6>
              <ul class="stars stars-sm">
                <li><i class="fas fa-star"></i></li>
                <li><i class="fas fa-star"></i></li>
                <li><i class="fas fa-star"></i></li>
                <li><i class="fas fa-star"></i></li>
              </ul>
            </div>
          </div>
        <% end %>
      </div>
    <% end %>

  </div>
</div>

